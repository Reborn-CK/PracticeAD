# PracticeAD - 回合制战斗游戏

这是一个基于事件驱动架构的回合制战斗游戏项目，使用Python开发。项目采用模块化设计，支持丰富的法术系统、状态效果、被动能力和战斗机制。

## 项目结构

```
PracticeAD/
├── data/                          # 数据文件
│   ├── characters.yaml           # 角色数据配置
│   ├── passives.yaml             # 被动能力配置
│   ├── spells.yaml               # 法术数据
│   └── status_effects.yaml       # 状态效果数据
├── game/                         # 游戏核心代码
│   ├── core/                     # 核心系统
│   │   ├── components.py         # 组件定义
│   │   ├── entity.py            # 实体类
│   │   ├── enums.py             # 事件枚举
│   │   ├── event_bus.py         # 事件总线
│   │   ├── payloads.py          # 事件载荷
│   │   └── pipeline.py          # 处理管道
│   ├── systems/                  # 游戏系统
│   │   ├── combat/              # 战斗系统
│   │   │   ├── combat_resolution_system.py # 战斗结算
│   │   │   ├── damage_processors.py # 伤害处理器
│   │   │   └── heal_processors.py # 治疗处理器
│   │   ├── character_factory.py # 角色工厂
│   │   ├── data_manager.py      # 数据管理
│   │   ├── dead_system.py       # 死亡系统
│   │   ├── enemy_ai_system.py   # 敌人AI
│   │   ├── interaction_system.py # 交互系统
│   │   ├── log_system.py        # 日志系统
│   │   ├── mana_system.py       # 法力系统
│   │   ├── passive_ability_system.py # 被动能力
│   │   ├── passive_factory.py   # 被动能力工厂
│   │   ├── player_input_system.py # 玩家输入
│   │   ├── spell_cast_system.py # 法术施放
│   │   ├── status_effect_system.py # 状态效果
│   │   ├── turn_manager_system.py # 回合管理
│   │   └── ui_system.py         # UI系统
│   ├── status_effects/           # 状态效果逻辑
│   │   ├── effect_logic.py      # 效果逻辑基类和子类
│   │   ├── status_effect_factory.py # 状态效果工厂
│   │   └── status_effect.py     # 状态效果类
│   ├── world.py                 # 游戏世界
│   └── main.py                  # 主程序
├── run_game.py                  # 游戏运行脚本
└── README.md                    # 项目说明
```

## 运行游戏

### 方法1：使用运行脚本（推荐）
```bash
python run_game.py
```

### 方法2：直接运行主程序
```bash
python -m game.main
```

## 游戏特性

### 核心系统
- **事件驱动架构**：所有游戏逻辑通过事件系统进行通信，系统间低耦合
- **组件系统**：实体通过组件组合实现不同功能，支持灵活扩展
- **回合制战斗**：基于速度的回合顺序，支持复杂的战斗机制
- **状态效果系统**：支持多种堆叠方式，应用、结算、堆叠逻辑完全封装
- **角色配置系统**：角色属性、被动能力、技能通过YAML文件配置
- **被动能力系统**：支持多种被动能力，如反伤、生命偷取、元素抗性等
- **处理管道系统**：伤害和治疗计算通过可扩展的处理管道进行

### 战斗系统
- **伤害计算管道**：支持暴击、护盾、抗性、反伤等复杂机制
- **治疗系统**：支持溢出治疗转换为护盾
- **生命偷取**：部分法术支持生命偷取
- **被动能力**：如绝地护盾、反伤、元素抗性等被动技能
- **法术交互**：如雪球术熄灭燃烧状态，风刃术延长燃烧时间
- **战斗播报优化**：播报顺序优化，先显示主伤害，再显示反伤和被动效果
- **抗性播报**：只有实际减伤时才播报抗性信息
- **暴击系统**：支持暴击判定和暴击伤害倍率

### 法术系统
- **多种效果类型**：伤害、治疗、状态效果、驱散、中毒强化、中毒引爆等
- **目标选择**：支持敌人、友军、任意目标
- **法术交互**：元素相克系统，如火系法术与燃烧状态交互
- **法力消耗**：每个法术都有相应的法力消耗
- **毒系法术**：毒云术、毒液强化、毒爆术形成完整的毒系连招
- **法术版本系统**：支持同一法术的多个版本，具有不同的效果和消耗

### 状态效果系统
- **多种堆叠方式**：
  - `refresh_duration`：刷新持续时间
  - `stack_intensity`：层数叠加
- **特殊中毒机制**：支持最多10个独立的中毒状态，每个状态独立计算层数
- **效果逻辑封装**：应用、结算、堆叠逻辑完全封装在各自的EffectLogic子类中
- **持续伤害**：如燃烧、中毒等
- **属性修改**：如加速、减速等
- **溢出治疗转换**：将溢出治疗转换为护盾

### 角色配置系统
- **YAML配置**：角色属性、被动能力、技能通过`data/characters.yaml`配置
- **模块化被动能力**：被动能力通过`data/passives.yaml`独立配置
- **自动验证**：角色工厂自动验证被动能力配置的有效性
- **灵活扩展**：新增角色只需修改YAML文件，无需修改代码

### 被动能力系统
- **多种被动类型**：
  - **反伤**：受到伤害时反弹部分伤害
  - **生命偷取**：造成伤害时恢复生命值
  - **元素抗性**：减少特定元素伤害
  - **绝地护盾**：生命值低时获得护盾
  - **攻击触发被动**：攻击时触发各种效果
  - **溢出治疗转护盾**：将溢出治疗转换为护盾
- **组件化设计**：每种被动能力对应一个组件
- **乘法叠加**：多个同类型被动能力可以叠加（如多个抗性组件）
- **事件驱动**：被动能力通过事件系统触发

## 法术列表

### 基础法术
- **普通攻击**：基础物理伤害法术，有多个版本
- **治疗术**：基础治疗法术
- **护盾术**：提供护盾保护
- **加速术**：提升速度
- **净化术**：驱散负面状态

### 元素法术
- **火球术**：火系伤害法术，可造成燃烧状态
- **燃烬**：消耗燃烧状态造成额外伤害
- **雪球术**：冰系伤害，可熄灭燃烧状态
- **风刃术**：风系伤害，可延长燃烧时间
- **雷霆术**：雷系伤害法术

### 毒系法术
- **毒云术**：施加多个中毒状态
- **毒液强化**：为所有中毒状态增加层数
- **毒爆术**：立即引爆所有中毒状态造成伤害

### 特殊法术
- **吸血术**：造成伤害并恢复生命值
- **溢疗转换**：将溢出治疗转换为护盾
- **迟缓诅咒**：降低目标速度

## 状态效果

### 持续伤害效果
- **燃烧**：每回合造成火系伤害
- **中毒**：每回合造成毒系伤害，支持多个独立状态

### 属性修改效果
- **加速**：提升速度
- **缓慢**：降低速度
- **潮湿**：提升火抗，降低雷抗

### 特殊效果
- **溢疗转换**：将溢出治疗转换为护盾

## 被动能力

### 伤害相关
- **反伤**：受到伤害时反弹部分伤害给攻击者
- **生命偷取**：造成伤害时恢复一定比例的生命值
- **攻击触发被动**：攻击时触发各种效果（伤害、治疗、状态效果等）

### 防御相关
- **元素抗性**：减少特定元素类型的伤害
- **绝地护盾**：生命值低于阈值时获得护盾保护
- **重伤**：降低受到的治疗效果

### 特殊效果
- **溢出治疗转护盾**：将溢出治疗转化为护盾

## 数据文件

### characters.yaml
定义所有角色的数据，包括：
- 角色名称和描述
- 基础属性（生命值、法力值、速度、护盾、暴击率、暴击伤害倍率等）
- 被动能力列表
- 法术列表

### passives.yaml
定义所有被动能力的数据，包括：
- 被动能力名称和描述
- 组件类型
- 组件参数
- 触发条件
- 不同版本的配置

### spells.yaml
定义所有法术的数据，包括：
- 法术名称和描述
- 法力消耗
- 目标类型
- 效果列表（伤害、治疗、状态效果等）
- 交互效果（如燃烬的消耗效果）
- 多个版本配置

### status_effects.yaml
定义所有状态效果的数据，包括：
- 效果名称和描述
- 持续时间
- 叠加规则
- 效果逻辑类型
- 上下文数据

## 开发说明

### 添加新角色
1. 在 `data/characters.yaml` 中添加角色定义
2. 确保相关的被动能力在 `data/passives.yaml` 中定义
3. 在 `game/main.py` 中使用角色工厂创建角色

### 添加新被动能力
1. 在 `data/passives.yaml` 中添加被动能力定义
2. 在 `game/core/components.py` 中定义对应的组件类
3. 在 `game/systems/passive_factory.py` 中注册组件创建逻辑
4. 在 `game/systems/passive_ability_system.py` 中实现被动能力逻辑

### 添加新法术
1. 在 `data/spells.yaml` 中添加法术定义
2. 确保相关的状态效果在 `data/status_effects.yaml` 中定义
3. 在角色的法术列表中添加法术ID

### 添加新状态效果
1. 在 `data/status_effects.yaml` 中添加效果定义
2. 在 `game/status_effects/effect_logic.py` 中实现效果逻辑类
3. 在 `game/status_effects/status_effect_factory.py` 的 `EFFECT_LOGIC_MAP` 中注册新的效果逻辑

### 添加新系统
1. 创建新的系统类
2. 在构造函数中订阅相关事件
3. 在 `game/main.py` 中注册系统

### 添加新的伤害/治疗处理器
1. 在 `game/systems/combat/damage_processors.py` 或 `heal_processors.py` 中创建新的处理器类
2. 继承 `BaseProcessor` 并实现 `_process` 方法
3. 在相应的处理管道中注册新的处理器

## 技术特点

- **模块化设计**：每个系统职责单一，易于维护和扩展
- **事件驱动架构**：系统间通过事件通信，降低耦合度
- **数据驱动**：游戏内容通过YAML文件配置，易于修改
- **类型提示**：使用Python类型提示提高代码可读性
- **错误处理**：完善的异常处理机制
- **状态效果重构**：应用、结算、堆叠逻辑完全封装，支持复杂效果
- **角色配置系统**：角色属性、被动能力、技能完全配置化
- **被动能力系统**：支持多种被动能力，组件化设计
- **战斗播报优化**：播报顺序和内容优化，提升用户体验
- **处理管道系统**：伤害和治疗计算通过可扩展的处理管道进行
- **暴击系统**：完整的暴击判定和伤害计算机制

## 依赖

- Python 3.7+
- PyYAML

安装依赖：
```bash
pip install pyyaml
```

## 版本历史

### 最新版本
- **处理管道系统**：伤害和治疗计算通过可扩展的处理管道进行
- **暴击系统**：完整的暴击判定和伤害计算机制
- **战斗播报优化**：播报顺序优化，先显示主伤害，再显示反伤和被动效果
- **抗性播报优化**：只有实际减伤时才播报抗性信息
- **多组件支持**：支持多个同类型组件的叠加计算
- **角色配置系统**：角色属性、被动能力、技能通过YAML文件配置
- **被动能力系统**：支持反伤、生命偷取、元素抗性等多种被动能力
- **状态效果系统重构**：应用、结算、堆叠逻辑完全封装
- **毒系法术系统**：完整的毒系连招系统
- **法术版本系统**：支持同一法术的多个版本

## 游戏截图

（这里可以添加游戏运行时的截图）

## 贡献

欢迎提交Issue和Pull Request来改进这个项目！

## 许可证

本项目采用MIT许可证。 